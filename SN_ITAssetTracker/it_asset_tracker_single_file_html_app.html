<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IT Asset Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            card: '#0B1220',
            ink: '#0f172a',
          }
        }
      }
    }
  </script>
  <style>
    /* Smooth scroll + subtle focus styles */
    html { scroll-behavior: smooth; }
    .focus-ring:focus { outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,.65); }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
  <div class="max-w-7xl mx-auto p-4 md:p-6 lg:p-8">
    <!-- Header -->
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-6">
      <div>
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">IT Asset Tracker</h1>
        <p class="text-slate-400 mt-1">Track laptops, phones, and tablets • Manage patches & OS • Flag replacements • Smart suggestions</p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2 bg-slate-800/60 border border-slate-700 rounded-xl px-3 py-2">
          <label for="refreshInterval" class="text-sm text-slate-300">Auto-refresh</label>
          <select id="refreshInterval" class="bg-transparent text-sm focus-ring">
            <option value="0">Off</option>
            <option value="5">Every 5s</option>
            <option value="10">Every 10s</option>
            <option value="30">Every 30s</option>
            <option value="60">Every 60s</option>
          </select>
        </div>
        <div class="flex items-center gap-2 bg-slate-800/60 border border-slate-700 rounded-xl px-3 py-2">
          <label for="demoCount" class="text-sm text-slate-300">Add demo</label>
          <input id="demoCount" type="number" min="1" value="5" class="w-16 bg-transparent text-sm border border-slate-700 rounded-lg px-2 py-1 focus-ring" />
          <button id="addDemoBtn" class="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 rounded-lg text-sm">Add</button>
        </div>
        <button id="exportBtn" class="px-3 py-2 bg-slate-800/60 border border-slate-700 rounded-xl text-sm hover:bg-slate-800">Export JSON</button>
      </div>
    </header>

    <!-- Summary Bar -->
    <section id="summary" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 mb-6"></section>

    <!-- Main Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Cards -->
      <section class="lg:col-span-2">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-xl font-semibold">Assets</h2>
          <div class="flex items-center gap-2">
            <input id="search" placeholder="Search by ID, user, or type…" class="bg-slate-800/60 border border-slate-700 rounded-lg px-3 py-2 text-sm focus-ring w-60" />
            <select id="filterStatus" class="bg-slate-800/60 border border-slate-700 rounded-lg px-3 py-2 text-sm focus-ring">
              <option value="">All statuses</option>
              <option>provisioned</option>
              <option>assigned</option>
              <option>up-for-replacement</option>
              <option>retired</option>
            </select>
            <select id="filterType" class="bg-slate-800/60 border border-slate-700 rounded-lg px-3 py-2 text-sm focus-ring">
              <option value="">All types</option>
              <option>laptop</option>
              <option>mobile</option>
              <option>tablet</option>
            </select>
          </div>
        </div>
        <div id="assetGrid" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
      </section>

      <!-- Sidebar: Alerts + Assistant -->
      <aside class="space-y-6">
        <section class="bg-slate-900 border border-slate-800 rounded-2xl p-4">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-lg font-semibold">Alerts</h3>
            <span id="alertCount" class="text-xs text-slate-400"></span>
          </div>
          <ul id="alerts" class="space-y-3"></ul>
        </section>
        <section class="bg-slate-900 border border-slate-800 rounded-2xl p-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold">Smart Assistant</h3>
            <button id="regenAssist" class="text-xs px-2 py-1 rounded-md border border-slate-700 hover:bg-slate-800">Regenerate</button>
          </div>
          <div id="assistant" class="space-y-3"></div>
        </section>
      </aside>
    </div>
  </div>

  <!-- Small modal -->
  <dialog id="modal" class="rounded-2xl p-0 bg-slate-900 text-slate-100 border border-slate-700 w-[32rem] max-w-[calc(100vw-2rem)]">
    <div class="p-4 border-b border-slate-800">
      <h4 id="modalTitle" class="font-semibold"></h4>
    </div>
    <div class="p-4 space-y-3" id="modalBody"></div>
    <div class="p-4 border-t border-slate-800 flex justify-end gap-2">
      <button id="modalCancel" class="px-3 py-2 rounded-lg border border-slate-700 hover:bg-slate-800">Cancel</button>
      <button id="modalOk" class="px-3 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500">OK</button>
    </div>
  </dialog>

  <template id="alertItemTpl">
    <li class="bg-slate-800/60 border border-slate-700 rounded-xl p-3">
      <div class="flex items-start justify-between gap-3">
        <div>
          <p class="text-sm font-medium"></p>
          <p class="text-xs text-slate-400 mt-1"></p>
        </div>
        <button class="text-xs px-2 py-1 rounded-md border border-slate-700 hover:bg-slate-800">Resolve</button>
      </div>
    </li>
  </template>

  <script>
    // ---------- Data Model ----------
    const state = {
      assets: [],
      alerts: [],
      timers: { refresh: null },
      search: '',
      filterStatus: '',
      filterType: '',
    };

    const TYPES = ['laptop','mobile','tablet'];
    const STATUSES = ['provisioned','assigned','up-for-replacement','retired'];

    function randChoice(arr){ return arr[Math.floor(Math.random()*arr.length)] }
    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min }

    function nowISO(){ return new Date().toISOString() }

    function daysAgo(n){ const d = new Date(); d.setDate(d.getDate()-n); return d.toISOString(); }

    function formatTs(ts){
      const d = new Date(ts);
      return d.toLocaleString();
    }

    function newId(){ return 'AST-' + Math.random().toString(36).slice(2,8).toUpperCase(); }

    function randomAsset(){
      const type = randChoice(TYPES);
      const assigned = Math.random() > 0.5;
      const ageDays = randInt(10, 1500); // ~ up to ~4 years
      const upToDate = Math.random() > 0.6 ? false : true;
      const patchApplied = Math.random() > 0.5;
      const flaggedReplacement = Math.random() > 0.85;
      const retired = Math.random() > 0.95;

      const a = {
        id: newId(),
        type,
        status: retired ? 'retired' : (flaggedReplacement ? 'up-for-replacement' : (assigned ? 'assigned':'provisioned')),
        patch: patchApplied ? 'applied' : 'pending',
        os: upToDate ? 'up-to-date' : 'pending',
        user: assigned ? randChoice(['alex.fernandez','priya.k','samir.p','meera.s','anita.r','john.d']) : '',
        lastUpdated: daysAgo(randInt(0,14)),
        lastActive: daysAgo(randInt(0,120)),
        ageDays,
      };
      return a;
    }

    // ---------- Persistence (in-memory, optional localStorage) ----------
    const STORAGE_KEY = 'it-asset-tracker-v1';
    function save(){
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state.assets)); } catch {}
    }
    function load(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){ state.assets = JSON.parse(raw); }
      } catch {}
    }

    // ---------- Rendering ----------
    function render(){
      renderSummary();
      renderAssets();
      regenerateAlerts();
      renderAssistant();
      save();
    }

    function renderSummary(){
      const el = document.getElementById('summary');
      const total = state.assets.length;
      const byType = TYPES.reduce((acc,t)=> (acc[t]=state.assets.filter(a=>a.type===t).length, acc), {});
      const upForReplacement = state.assets.filter(a=>a.status==='up-for-replacement').length;
      const pendingPatches = state.assets.filter(a=>a.patch==='pending' && a.status!=='retired').length;
      const pendingOS = state.assets.filter(a=>a.os==='pending' && a.status!=='retired').length;

      const card = (title,val,sub='') => `
        <div class="bg-slate-900 border border-slate-800 rounded-2xl p-4">
          <div class="text-sm text-slate-400">${title}</div>
          <div class="text-2xl font-semibold">${val}</div>
          ${sub ? `<div class="text-xs text-slate-400 mt-1">${sub}</div>`:''}
        </div>`;

      el.innerHTML = [
        card('Total assets', total, `${byType.laptop||0} laptop • ${byType.mobile||0} mobile • ${byType.tablet||0} tablet`),
        card('By type: Laptops', byType.laptop||0),
        card('By type: Mobiles', byType.mobile||0),
        card('Up for replacement', upForReplacement),
        card('Pending: Patches / OS', `${pendingPatches} / ${pendingOS}`)
      ].join('');
    }

    function renderAssets(){
      const grid = document.getElementById('assetGrid');
      const q = state.search.toLowerCase();
      const filt = state.assets.filter(a=>{
        const okQ = !q || a.id.toLowerCase().includes(q) || a.user.toLowerCase().includes(q) || a.type.includes(q);
        const okS = !state.filterStatus || a.status===state.filterStatus;
        const okT = !state.filterType || a.type===state.filterType;
        return okQ && okS && okT;
      });

      grid.innerHTML = filt.map(assetCardHTML).join('');

      // Attach per-card handlers
      filt.forEach(a=> attachCardHandlers(a.id));
    }

    function pill(text, tone){
      const tones = {
        ok: 'bg-emerald-500/10 text-emerald-300 border-emerald-600/40',
        warn: 'bg-amber-500/10 text-amber-300 border-amber-600/40',
        bad: 'bg-rose-500/10 text-rose-300 border-rose-600/40',
        info: 'bg-sky-500/10 text-sky-300 border-sky-600/40',
        mute: 'bg-slate-600/20 text-slate-300 border-slate-600/30'
      }
      return `<span class="px-2 py-0.5 text-[11px] border rounded-full ${tones[tone]||tones.mute}">${text}</span>`
    }

    function assetCardHTML(a){
      const statusTone = {
        'assigned':'info', 'provisioned':'warn', 'up-for-replacement':'bad', 'retired':'mute'
      }[a.status] || 'mute';
      const patchTone = a.patch==='applied'?'ok':'warn';
      const osTone = a.os==='up-to-date'?'ok':'bad';

      const actions = [];
      if(a.status!=='retired'){
        actions.push(`<button data-act="assign" class="px-2 py-1 text-xs rounded-lg border border-slate-700 hover:bg-slate-800">${a.user? 'Unassign':'Assign'}</button>`);
        actions.push(`<button data-act="patch" class="px-2 py-1 text-xs rounded-lg border border-slate-700 hover:bg-slate-800">Mark Patch ${a.patch==='pending'?'Applied':'Pending'}</button>`);
        actions.push(`<button data-act="flag" class="px-2 py-1 text-xs rounded-lg border border-amber-700 text-amber-300 hover:bg-amber-950/40">${a.status==='up-for-replacement'?'Unflag':'Flag Replacement'}</button>`);
        actions.push(`<button data-act="retire" class="px-2 py-1 text-xs rounded-lg border border-rose-700 text-rose-300 hover:bg-rose-950/40">Retire</button>`);
      } else {
        actions.push(`<button data-act="restore" class="px-2 py-1 text-xs rounded-lg border border-emerald-700 text-emerald-300 hover:bg-emerald-950/40">Restore</button>`);
      }

      return `
      <article class="bg-card border border-slate-800 rounded-2xl p-4 flex flex-col gap-3">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-xs text-slate-400">Asset</div>
            <div class="font-semibold tracking-tight">${a.id}</div>
          </div>
          <div class="flex gap-2 flex-wrap justify-end">
            ${pill(a.type,'info')}
            ${pill(a.status, statusTone)}
            ${pill('Patch: '+a.patch, patchTone)}
            ${pill('OS: '+a.os, osTone)}
          </div>
        </div>
        <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
          <div class="text-slate-400">Assigned user</div>
          <div class="">${a.user || '<span class=\'text-slate-500\'>—</span>'}</div>
          <div class="text-slate-400">Age</div>
          <div class="">${a.ageDays} days</div>
          <div class="text-slate-400">Last active</div>
          <div class="">${formatTs(a.lastActive)}</div>
          <div class="text-slate-400">Last updated</div>
          <div class="">${formatTs(a.lastUpdated)}</div>
        </div>
        <div class="flex flex-wrap gap-2 pt-2 border-t border-slate-800">
          ${actions.join('')}
        </div>
      </article>`;
    }

    function attachCardHandlers(id){
      const card = [...document.querySelectorAll('#assetGrid article')].find(el => el.querySelector('.font-semibold').textContent===id);
      if(!card) return;
      card.querySelectorAll('button[data-act]').forEach(btn=>{
        btn.addEventListener('click', ()=> handleAction(id, btn.getAttribute('data-act')));
      });
    }

    function handleAction(id, act){
      const a = state.assets.find(x=>x.id===id);
      if(!a) return;
      if(act==='assign'){
        if(a.user){
          a.user = '';
          a.status = 'provisioned';
        } else {
          promptModal(`Assign ${a.id}`, `Enter username to assign:`, a.user, (val)=>{
            if(val){ a.user = val; a.status = 'assigned'; a.lastActive = nowISO(); }
          });
          return; // modal renders after callback
        }
      }
      if(act==='patch'){
        a.patch = (a.patch==='pending')?'applied':'pending';
      }
      if(act==='flag'){
        a.status = (a.status==='up-for-replacement') ? (a.user? 'assigned':'provisioned') : 'up-for-replacement';
      }
      if(act==='retire'){
        a.status = 'retired';
        a.user = '';
      }
      if(act==='restore'){
        a.status = 'provisioned';
      }
      a.lastUpdated = nowISO();
      render();
    }

    // ---------- Alerts ----------
    function regenerateAlerts(){
      const alerts = [];
      const now = Date.now();

      state.assets.forEach(a=>{
        // Overdue OS updates: OS pending and lastUpdated older than 7 days
        const daysSinceUpdate = Math.round((now - new Date(a.lastUpdated).getTime())/86400000);
        if(a.os==='pending' && a.status!=='retired'){
          const sev = daysSinceUpdate>14 ? 'High' : 'Medium';
          alerts.push({
            id: `os-${a.id}`,
            text: `${a.id}: OS update pending`,
            rationale: `${sev} priority • last update ${daysSinceUpdate} days ago`,
            resolve: ()=>{ a.os='up-to-date'; a.lastUpdated=nowISO(); render(); }
          });
        }
        // Unassigned devices idle > 30 days
        const idleDays = Math.round((now - new Date(a.lastActive).getTime())/86400000);
        if(!a.user && a.status!=='retired' && idleDays>30){
          alerts.push({
            id: `idle-${a.id}`,
            text: `${a.id}: Unassigned and idle`,
            rationale: `Idle for ${idleDays} days • consider reassigning or retiring`,
            resolve: ()=>{ a.lastActive = nowISO(); render(); }
          });
        }
        // Flagged for replacement
        if(a.status==='up-for-replacement'){
          alerts.push({
            id: `rep-${a.id}`,
            text: `${a.id}: Flagged for replacement`,
            rationale: `Asset age ${a.ageDays} days • plan procurement`,
            resolve: ()=>{ a.status = a.user? 'assigned':'provisioned'; a.lastUpdated=nowISO(); render(); }
          });
        }
      });

      state.alerts = alerts;
      const ul = document.getElementById('alerts');
      const count = document.getElementById('alertCount');
      count.textContent = `${alerts.length} issues`;
      ul.innerHTML = '';
      const tpl = document.getElementById('alertItemTpl');
      alerts.forEach(al=>{
        const li = tpl.content.cloneNode(true);
        li.querySelector('p.text-sm').textContent = al.text;
        li.querySelector('p.text-xs').textContent = al.rationale;
        li.querySelector('button').addEventListener('click', ()=> al.resolve());
        ul.appendChild(li);
      });
    }

    // ---------- Smart Assistant ----------
    function renderAssistant(){
      const wrap = document.getElementById('assistant');
      wrap.innerHTML = '';

      const pendingOS = state.assets.filter(a=>a.os==='pending' && a.status!=='retired');
      const idle = state.assets.filter(a=>!a.user && a.status!=='retired' && (Date.now()-new Date(a.lastActive))/86400000>30);
      const replacements = state.assets.filter(a=>a.status==='up-for-replacement');

      const suggestions = [];
      if(pendingOS.length){
        suggestions.push({
          title: `Bulk update OS on ${pendingOS.length} device(s)`,
          detail: 'Bring all devices to up-to-date. Marks OS as updated and refreshes timestamps.',
          action: ()=>{ pendingOS.forEach(a=>{ a.os='up-to-date'; a.lastUpdated=nowISO(); }); render(); }
        });
      }
      if(idle.length){
        suggestions.push({
          title: `Review ${idle.length} idle unassigned device(s)`,
          detail: 'Assign to users or retire to reduce unused inventory.',
          action: ()=>{
            // Quick assign via prompt applied to all idle assets
            promptModal('Assign idle devices', 'Enter username to assign to all idle devices (leave empty to just update last active):', '', (val)=>{
              idle.forEach(a=>{
                if(val){ a.user = val; a.status='assigned'; a.lastActive=nowISO(); }
                else { a.lastActive = nowISO(); }
                a.lastUpdated=nowISO();
              });
              render();
            });
          }
        });
      }
      if(replacements.length){
        suggestions.push({
          title: `Schedule replacement for ${replacements.length} asset(s)`,
          detail: 'Moves flagged devices to retired state and clears assignments.',
          action: ()=>{ replacements.forEach(a=>{ a.status='retired'; a.user=''; a.lastUpdated=nowISO(); }); render(); }
        });
      }
      if(!suggestions.length){
        suggestions.push({ title:'All good!', detail:'No immediate actions suggested. Check again after the next refresh.' });
      }

      suggestions.forEach(s=>{
        const card = document.createElement('div');
        card.className = 'bg-slate-800/60 border border-slate-700 rounded-xl p-3';
        card.innerHTML = `
          <div class="font-medium">${s.title}</div>
          <div class="text-sm text-slate-400 mt-1">${s.detail}</div>
          ${s.action? '<div class="mt-2"><button class="px-3 py-1.5 text-xs rounded-lg bg-indigo-600 hover:bg-indigo-500">Apply</button></div>':''}
        `;
        if(s.action){ card.querySelector('button').addEventListener('click', s.action); }
        wrap.appendChild(card);
      });
    }

    // ---------- Utilities: Modal ----------
    function promptModal(title, label, value, onOk){
      const dlg = document.getElementById('modal');
      document.getElementById('modalTitle').textContent = title;
      const body = document.getElementById('modalBody');
      body.innerHTML = `
        <label class="block text-sm text-slate-300 mb-1">${label}</label>
        <input id="modalInput" value="${value||''}" class="w-full bg-slate-800/60 border border-slate-700 rounded-lg px-3 py-2 text-sm focus-ring" />`;
      const ok = document.getElementById('modalOk');
      const cancel = document.getElementById('modalCancel');
      const cleanup = ()=>{
        ok.replaceWith(ok.cloneNode(true)); // remove handlers
        cancel.replaceWith(cancel.cloneNode(true));
      }
      ok.addEventListener('click', ()=>{ const v = document.getElementById('modalInput').value.trim(); dlg.close(); cleanup(); onOk && onOk(v); });
      cancel.addEventListener('click', ()=>{ dlg.close(); cleanup(); });
      dlg.showModal();
      setTimeout(()=>{ document.getElementById('modalInput').focus(); }, 10);
    }

    // ---------- Auto-refresh simulation ----------
    function applyAutoRefresh(sec){
      if(state.timers.refresh){ clearInterval(state.timers.refresh); state.timers.refresh=null; }
      if(!sec) return;
      state.timers.refresh = setInterval(()=>{
        // Randomly drift some statuses to simulate updates
        state.assets.forEach(a=>{
          if(a.status==='retired') return;
          if(Math.random()<0.1) a.os = (Math.random()<0.7)? 'up-to-date':'pending';
          if(Math.random()<0.08) a.patch = (Math.random()<0.6)? 'applied':'pending';
          if(Math.random()<0.05) a.lastActive = daysAgo(randInt(0,120));
          if(Math.random()<0.03 && a.status!=='up-for-replacement') a.status = 'up-for-replacement';
          a.lastUpdated = nowISO();
        });
        render();
      }, sec*1000);
    }

    // ---------- Event wiring ----------
    function wireUI(){
      document.getElementById('addDemoBtn').addEventListener('click', ()=>{
        const n = parseInt(document.getElementById('demoCount').value)||1;
        for(let i=0;i<n;i++) state.assets.unshift(randomAsset());
        render();
      });
      document.getElementById('refreshInterval').addEventListener('change', (e)=>{
        const sec = parseInt(e.target.value);
        applyAutoRefresh(sec);
      });
      document.getElementById('search').addEventListener('input', (e)=>{ state.search = e.target.value; renderAssets(); });
      document.getElementById('filterStatus').addEventListener('change', (e)=>{ state.filterStatus = e.target.value; renderAssets(); });
      document.getElementById('filterType').addEventListener('change', (e)=>{ state.filterType = e.target.value; renderAssets(); });
      document.getElementById('regenAssist').addEventListener('click', renderAssistant);
      document.getElementById('exportBtn').addEventListener('click', ()=>{
        const blob = new Blob([JSON.stringify(state.assets, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'assets.json'; a.click(); URL.revokeObjectURL(url);
      });
    }

    // ---------- Init ----------
    function seedInitial(){
      if(state.assets.length) return;
      for(let i=0;i<9;i++){ state.assets.push(randomAsset()); }
      // Ensure a few deterministics
      state.assets.push({ id: 'AST-LAPTOP-001', type:'laptop', status:'assigned', patch:'pending', os:'pending', user:'meera.s', lastUpdated: daysAgo(10), lastActive: daysAgo(25), ageDays: 820 });
      state.assets.push({ id: 'AST-PHONE-002', type:'mobile', status:'provisioned', patch:'applied', os:'up-to-date', user:'', lastUpdated: daysAgo(2), lastActive: daysAgo(65), ageDays: 400 });
      state.assets.push({ id: 'AST-TAB-003', type:'tablet', status:'up-for-replacement', patch:'pending', os:'up-to-date', user:'alex.fernandez', lastUpdated: daysAgo(5), lastActive: daysAgo(3), ageDays: 1500 });
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      load();
      seedInitial();
      wireUI();
      render();
    });
  </script>
</body>
</html>
